<html>

<header>
    <title>CS262</title>
    <link href="cs262.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js">
    </script>

    <script> 
    // http://blog.oddbit.com/2013/11/23/long-polling-with-ja/
        function poll() {
            var poll_interval=0;
            var get_url; 
            get_url = $.ajax({
                    url: "/getmsg",
                    type: 'GET',
                    //dataType: 'text/html',
                    success: function(data) {
                            var msg_to_add = "<div> "+ data + "</div>";
                            var message_posted = $("#boxed").append(msg_to_add);
                           //document.write(data)
                            //alert(data.getAllResponseHeaders());
                            var msg_id = get_url.getResponseHeader("message_id"); 
                            $.ajax({
                                url: "/receivedmsg",
                                type: 'GET',
                                //data:  msg_id,
                                //dataType: 'text/html',
                            });
                            
                            //document.write(data);
                            poll_interval=0;
                    },
                    error: function () {
                            poll_interval=1000;
                    },
                    complete: function (data) {
                            //window.alert("complete!");
                            //window.alert(data);
                            setTimeout(poll, poll_interval);
                    },
            });
        }

        $(document).ready(function() {
            poll();
        }); 

    </script>

</header>

<body>
    <h1>CS262: Welcome, <script>document.write(document.cookie)</script>!</h1>

    <div id="boxed">
        This is where the messages will go.
    </div> <br/><br/>

    <form method="POST" action="/messages">
        <label>Message recipient: </label>
        <input type="text" name="recipient" /><br/><br/>
        <label>Insert your message (120 character limit): </label>
        <input id="msg_out" type="text" name="content"/><br/>
        <input type="submit" value="Send"/>
    </form>

    <form method="GET" action="/create_group.html">
        <input type="submit" value="Create Group"/>
    </form>

    <form method="GET" action="/join_group.html">
        <input type="submit" value="Join Existing Group"/>
    </form>

    <form method="GET" action="/see_groups.html">
        <input type="submit" value="See Existing Groups"/>
    </form>

    <form method="GET" action="/see_users.html">
        <input type="submit" value="See Existing Users"/>
    </form>

</body>

</html>